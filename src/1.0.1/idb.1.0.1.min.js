(function(b){var c,a;b.indexedDB=b.indexedDB||b.mozIndexedDB||b.webkitIndexedDB||b.msIndexedDB;b.IDBTransaction=b.IDBTransaction||b.webkitIDBTransaction||b.msIDBTransaction;b.IDBKeyRange=b.IDBKeyRange||b.webkitIDBKeyRange||b.msIDBKeyRange;b.IDB=function(e,f,g){var d=this,h;this.setup=e;if(!this.setup.db||!this.setup.version||!this.setup.stores||!this.setup.stores.length){if(typeof g==="function"){g.call(this,{errorMessage:"Database Name and/or Store is not defined."})}return}h=b.indexedDB.open(this.setup.db,this.setup.version);h.onerror=function(i){if(typeof g==="function"){g.call(d,i)}};h.onsuccess=function(i){d.db=i.target.result;if(typeof f==="function"){f.call(d,i)}};h.onupgradeneeded=function(r){var m=r.target.result,p,q,k,o,j,n;for(o=0,j=d.setup.stores.length;o<j;o++){k=d.setup.stores[o];if(m.objectStoreNames.contains(k.name)){m.deleteObjectStore(k.name)}q=m.createObjectStore(k.name,k.keyPath?{keyPath:k.keyPath}:{autoIncrement:true});for(n in k.schema){if(k.schema.hasOwnProperty(n)){p=k.schema[n];q.createIndex(n,n,{unique:!!(p&&typeof p==="object"&&p.unique)})}}}r.target.transaction.onerror=function(i){if(typeof g==="function"){g.call(d,i)}}}};b.IDB.prototype.exportData=function(j){var k=this,d=0,h=this.db.objectStoreNames,n={},e,m,g,f;m=function(){e=h[d];if(e){k.query(null,null,e,0,0,"next",function(l,i){n[e]=i;d++;m()})}else{if(typeof j==="function"){j.call(k,n)}}};m()};b.IDB.prototype.getStoreInfo=function(g,f,e){var d=this,i=this.openStore(g,"readonly"),h=i.count();h.onerror=function(j){if(typeof e==="function"){e.call(d,j)}};h.onsuccess=function(j){if(typeof f==="function"){f.call(d,j,{store:i,count:j.target.result})}}};b.IDB.prototype.importData=function(l,h,f){var k=this,d=0,j=Object.keys(l),e,g,i;g=function(){i=j[d];e=l[i];if(i&&e){k.insert(e,true,i,function(){d++;g()},function(m){if(typeof f==="function"){f.call(k,m)}})}else{if(typeof h==="function"){h.call(k,l)}}};g()};b.IDB.prototype.insert=function(l,i,k,j,g){var n=this,m=this.openStore(k,"readwrite"),d=i?"put":"add",e=0,f,h;if(l.length){h=function(){f=m[d](l[e]);f.onerror=function(o){if(typeof g==="function"){g.call(n,o)}};f.onsuccess=function(o){e++;if(l[e]){h()}else{if(typeof j==="function"){j.call(n,o)}}}};h()}else{f=m[d](l);a(f,j,g)}};b.IDB.prototype.openStore=function(d,g){var e,f;if(!g||g!=="readwrite"||g!=="readonly"){g="readwrite"}f=this.db.transaction([d],g);e=f.objectStore(d);return e};b.IDB.prototype.query=function(d,k,n,g,f,o,l,j){var r=this,e=0,i=[],m={next:"next",nextunique:"nextunique",prev:"prev",prevunique:"prevunique"},q=this.openStore(n,"readonly"),p=g*f,h;if(!m[o]){o=m.next}q=k?q.index(k):q;h=q.openCursor(d,o);h.onerror=function(s){if(typeof j==="function"){j.call(r,s)}};h.onsuccess=function(s){var t=s.target.result;if(t){if(p){t.advance(p);p=0;return}if(!f||(f&&e)<f){i.push(c(t));e++;t["continue"]();return}}if(typeof l==="function"){l.call(r,s,i)}}};b.IDB.prototype.queryMultipleKeys=function(l,h,j,i,f){var k=this,g=0,m=[],d,e;if(l.length){d=l&&typeof l==="object"&&l.length;m=[];e=function(p){var o,n;if(g<d){k.query(b.IDBKeyRange.only(l[g]),h||null,j,0,0,"next",function(r,q){if(q.length){for(o=0,n=q.length;o<n;o++){m.push(c({value:q[o],key:l[g]}))}}g++;e(r)})}else{if(typeof i==="function"){i.call(k,p,m)}}};e()}else{if(typeof f==="function"){f.call(k,{errorMessage:"Keys not provided."})}}};b.IDB.prototype.remove=function(k,i,h,g){var l=this,j=this.openStore(i,"readwrite"),d=0,f,e;if(k.length){e=function(){f=j["delete"](k[d]);f.onerror=function(m){if(typeof g==="function"){g.call(l,m)}};f.onsuccess=function(m){d++;if(k[d]){e()}else{if(typeof h==="function"){h.call(l,m)}}}};e()}else{f=j["delete"](k);a(f,h,g)}};b.IDB.prototype.update=function(i,k,h,g,f){var l=this,j=this.openStore(h,"readwrite"),d=j.openCursor(IDBKeyRange.only(k)),e=[];d.onerror=function(m){if(typeof f==="function"){f.call(l,m)}};d.onsuccess=function(n){var o=n.target.result,m;if(o){for(m in o.value){if(o.value.hasOwnProperty(m)&&i[m]){o.value[m]=i[m]}}o.update(o.value);e.push(c(o));o["continue"]()}else{if(typeof g==="function"){g.call(l,n,e)}}}};c=function(d){return d?d.value:undefined};a=function(g,f,e){var d=this;g.onerror=function(h){if(typeof e==="function"){e.call(d,h)}};g.onsuccess=function(h){if(typeof f==="function"){f.call(d,h)}}}})(window);