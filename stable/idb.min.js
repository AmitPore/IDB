(function(f){var p,q;f.IDB=function(a,b,c){var d=this;this.config={};this.setup=a;this.setup.db&&this.setup.version&&this.setup.stores&&this.setup.stores.length?(a=f.indexedDB.open(this.setup.db,this.setup.version),a.onerror=function(a){"function"===typeof c&&c.call(d,a)},a.onsuccess=function(a){d.db=a.target.result;"function"===typeof b&&b.call(d,a)},a.onupgradeneeded=function(a){var b=a.target.result,g,m,h,l,f,k;l=0;for(f=d.setup.stores.length;l<f;l++)for(k in h=d.setup.stores[l],b.objectStoreNames.contains(h.name)&&
    b.deleteObjectStore(h.name),m=b.createObjectStore(h.name,h.keyPath?{keyPath:h.keyPath}:{autoIncrement:!0}),h.schema)h.schema.hasOwnProperty(k)&&(g=h.schema[k],m.createIndex(k,k,{unique:!(!g||"object"!==typeof g||!g.unique)}));a.target.transaction.onerror=function(a){"function"===typeof c&&c.call(d,a)}}):"function"===typeof c&&c.call(this,{errorMessage:"Database Name and/or Store is not defined."})};f.IDB.prototype.getStoreInfo=function(a,b,c){var d=this,e=this.openStore(a,"readonly");a=e.count();
    a.onerror=function(a){"function"===typeof c&&c.call(d,a)};a.onsuccess=function(a){"function"===typeof b&&b.call(d,a,{store:e,count:a.target.result})}};f.IDB.prototype.insert=function(a,b,c,d,e){a=this.openStore(c,"readwrite")[b?"put":"add"](a);q(a,d,e)};f.IDB.prototype.openStore=function(a,b){b&&"readwrite"===b&&"readonly"===b||(b="readwrite");return this.db.transaction([a],b).objectStore(a)};f.IDB.prototype.query=function(a,b,c,d,e,f,g,m){var h=this,l=0,s=[],k={next:"next",nextunique:"nextunique",
    prev:"prev",prevunique:"prevunique"};c=this.openStore(c,"readonly");var n=d*e;k[f]||(f=k.next);c=b?c.index(b):c;a=c.openCursor(a,f);a.onerror=function(a){"function"===typeof m&&m.call(h,a)};a.onsuccess=function(a){var b=a.target.result;if(b){if(n){b.advance(n);n=0;return}if(!e||(e&&l)<e){s.push(p(b));l++;b["continue"]();return}}"function"===typeof g&&g.call(h,a,s)}};f.IDB.prototype.queryMultipleKeys=function(a,b,c,d,e){var r=this,g=0,m=[],h,l;a.length?(h=a&&"object"===typeof a&&a.length,m=[],l=function(e){var k,
    n;g<h?r.query(f.IDBKeyRange.only(a[g]),b||null,c,0,0,function(b,c){if(c.length)for(k=0,n=c.length;k<n;k++)m.push(p({value:c[k].value,key:a[g]}));g++;l(b)}):"function"===typeof d&&d.call(r,e,m)},l()):"function"===typeof e&&e.call(r,{errorMessage:"Keys not provided."})};f.IDB.prototype.remove=function(a,b,c,d){a=this.openStore(b,"readwrite")["delete"](a);q(a,c,d)};f.IDB.prototype.update=function(a,b,c,d,e){var f=this;b=this.openStore(c,"readwrite").openCursor(IDBKeyRange.only(b));var g=[];b.onerror=
    function(a){"function"===typeof e&&e.call(f,a)};b.onsuccess=function(b){var c=b.target.result;if(c){for(var e in c.value)c.value.hasOwnProperty(e)&&a[e]&&(c.value[e]=a[e]);c.update(c.value);g.push(p(c));c["continue"]()}else"function"===typeof d&&d.call(f,b,g)}};p=function(a){return a?{value:a.value,key:a.key}:void 0};q=function(a,b,c){var d=this;a.onerror=function(a){"function"===typeof c&&c.call(d,a)};a.onsuccess=function(a){"function"===typeof b&&b.call(d,a)}}})(window);