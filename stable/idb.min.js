(function(f){var p,q;f.IDB=function(a,b,c){var d=this;this.config={};this.setup=a;this.setup.db&&this.setup.version&&this.setup.stores&&this.setup.stores.length?(a=f.indexedDB.open(this.setup.db,this.setup.version),a.onerror=function(a){"function"===typeof c&&c.call(d,a)},a.onsuccess=function(a){d.db=a.target.result;"function"===typeof b&&b.call(d,a)},a.onupgradeneeded=function(a){var b=a.target.result,h,m,g,l,f,k;l=0;for(f=d.setup.stores.length;l<f;l++)for(k in g=d.setup.stores[l],b.objectStoreNames.contains(g.name)&&
    b.deleteObjectStore(g.name),m=b.createObjectStore(g.name,g.keyPath?{keyPath:g.keyPath}:{autoIncrement:!0}),g.schema)g.schema.hasOwnProperty(k)&&(h=g.schema[k],m.createIndex(k,k,{unique:!(!h||"object"!==typeof h||!h.unique)}));a.target.transaction.onerror=function(a){"function"===typeof c&&c.call(d,a)}}):"function"===typeof c&&c.call(this,{errorMessage:"Database Name and/or Store is not defined."})};f.IDB.prototype.getStoreInfo=function(a,b,c){var d=this,e=this.openStore(a,"readonly");a=e.count();
    a.onerror=function(a){"function"===typeof c&&c.call(d,a)};a.onsuccess=function(a){"function"===typeof b&&b.call(d,a,{store:e,count:a.target.result})}};f.IDB.prototype.insert=function(a,b,c,d,e){a=this.openStore(c,"readwrite")[b?"put":"add"](a);q(a,d,e)};f.IDB.prototype.openStore=function(a,b){b&&"readwrite"===b&&"readonly"===b||(b="readwrite");return this.db.transaction([a],b).objectStore(a)};f.IDB.prototype.query=function(a,b,c,d,e,f,h,m){var g=this,l=0,n=[],k={next:"next",nextunique:"nextunique",
    prev:"prev",prevunique:"prevunique"};c=this.openStore(c,"readonly");var r=d*e;k[f]||(f=k.next);c=b?c.index(b):c;a=c.openCursor(a,f);a.onerror=function(a){"function"===typeof m&&m.call(g,a)};a.onsuccess=function(a){var b=a.target.result;if(b){if(r){b.advance(r);r=0;return}if(!e||(e&&l)<e){n.push(p(b));l++;b["continue"]();return}}"function"===typeof h&&h.call(g,a,n)}};f.IDB.prototype.queryMultipleKeys=function(a,b,c,d,e,s,h){var m=this,g=0,l=[],n,k;a.length?("number"===typeof d&&0<=d&&"number"===typeof e&&
    0<e&&(a=a.splice(d*e,e)),n=a&&"object"===typeof a&&a.length,l=[],k=function(d){var e,h;g<n?m.query(f.IDBKeyRange.only(a[g]),b||null,c,0,0,function(b,c){if(c.length)for(e=0,h=c.length;e<h;e++)l.push(p({value:c[e].value,key:a[g]}));g++;k(b)}):"function"===typeof s&&s.call(m,d,l)},k()):"function"===typeof h&&h.call(m,{errorMessage:"Keys not provided."})};f.IDB.prototype.remove=function(a,b,c,d){a=this.openStore(b,"readwrite")["delete"](a);q(a,c,d)};f.IDB.prototype.update=function(a,b,c,d,e){var f=this;
    b=this.openStore(c,"readwrite").openCursor(IDBKeyRange.only(b));var h=[];b.onerror=function(a){"function"===typeof e&&e.call(f,a)};b.onsuccess=function(b){var c=b.target.result;if(c){for(var e in c.value)c.value.hasOwnProperty(e)&&a[e]&&(c.value[e]=a[e]);c.update(c.value);h.push(p(c));c["continue"]()}else"function"===typeof d&&d.call(f,b,h)}};p=function(a){return a?{value:a.value,key:a.key}:void 0};q=function(a,b,c){var d=this;a.onerror=function(a){"function"===typeof c&&c.call(d,a)};a.onsuccess=
    function(a){"function"===typeof b&&b.call(d,a)}}})(window);